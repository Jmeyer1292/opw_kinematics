sudo: required

git:
  quiet: true

env:
  global:
    - ROS_REPO=ros
    - CMAKE_ARGS="-DENABLE_TESTS=ON"

jobs:
  include:
    - os: linux
      dist: trusty
      language: cpp
      env:
      - ROS_DISTRO="kinetic"
      - CCACHE_DIR=$HOME/.ccache
      cache:
        directories:
          - $HOME/.ccache
    - os: linux
      dist: xenial
      language: cpp
      env:
      - ROS_DISTRO="melodic"
      - CCACHE_DIR=$HOME/.ccache
      cache:
        directories:
          - $HOME/.ccache
    - os: windows
      language: cpp

install:
  - if [ "$TRAVIS_OS_NAME" != "windows" ]; then git clone --quiet --depth=1 https://github.com/ros-industrial/industrial_ci.git .ci_config; fi
  - |
    if [ "$TRAVIS_OS_NAME" = "windows" ]; then
        unset CXX
        CXX_FOR_BUILD
        unset CC
        unset CC_FOR_BUILD
        choco feature disable -n=showDownloadProgress
        cd ..
        mkdir -p catkin_ws/src
        mv opw_kinematics catkin_ws/src/
        cd catkin_ws
        choco uninstall mingw
        choco source add -n=ros-win -s="https://roswin.azurewebsites.net/api/v2" --priority=1
        choco install ros-melodic-ros_base -y --execution-timeout=0
        cmd "/C call src/opw_kinematics/travis_ci_windows_install.bat"
    fi

script:
  - if [ "$TRAVIS_OS_NAME" != "windows" ]; then .ci_config/travis.sh; fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then cmd "/C call src/opw_kinematics/travis_ci_windows.bat"; fi
